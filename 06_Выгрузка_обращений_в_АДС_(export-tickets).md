[TOC]

# Описание

Выгрузка данных производится программно по протоколу [обмена данными](/Для_разработчиков/Протокол_обмена), либо на странице *Сервисы — ТСЖ: Аварийно-диспетчерская служба — Экспорт заявок* в [административной части](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=35&LESSON_ID=2833#admin) сайта.

В результате выгружаются все обращения, поступившие с момента последней [подтвержденной выгрузки].

**Параметры запроса**:

|             | Возможные значения    |  Описание |
| ----------- | --------------------- | -------- |
| **mode**    | `export`              | |
| **type**    | `tickets`             | |
| **inn**     | Целое число           | На сайте должен существовать *Объект управления* с указанным ИНН |

> Обязательные параметры выделены полужирным

## Подтверждение выгрузки

Механизм подтверждения выгрузки используется для сокращения объема передаваемых данных: при последующих запросах на выгрузку обращений, в неё попадут только новые или измененные с момента последней выгрузки обращения.

Для работы этого механизма требуется **в одной сессии** (с одним Cookie) сделать сначала запрос на выгрузку данных, а затем запрос **подтверждения**.

**Параметры запроса**

|             | Возможные значения    |  Описание |
| ----------- | --------------------- | -------- |
| **mode**    | `export`              | |
| **type**    | `tickets`             | |
| **inn**     | Целое число           | Должен совпадать с предыдущим запросом на получение данных |
| **result**  | `success`             | |

> Обязательные параметры выделены полужирным

# Пример файла

```xml
<?xml version="1.0" encoding="windows-1251"?>
<requests filedate="14.01.2015 15:54:08" filetype="tickets" version="3">
	<statuses>
		<status id="5" title="Новая заявка" />
		<status id="6" title="Передана на исполнение" />
		<status id="7" title="Принята на исполнение" />
		<status id="8" title="Выполнена" />
		<status id="9" title="Завершена" />
	</statuses>
	<categories>
		<category id="1" title="Общее" />
	</categories>

	<request id="000000001" number="1" status="5" category="">
		<title>Течет труба в туалете</title>
		<text>В туалете подтекает труба - необходима замена.</text>
		<date>29.01.2013 14:59:19</date>
		<contoldate>29.01.2013 14:59:19</contoldate>
		<address>
			<building>Москва г, Вавилова ул, 67</building>
			<flat>13</flat>
		</address>
		<fio>Юрий Лебедев Викторович</fio>
		<account>2011067013</account>
	</request>
	<request id="000000002" number="1" status="5" category="1">
		<title>!!!</title>
		<text>течет кран</text>
		<date>12.02.2014 10:17:48</date>
		<contoldate>14.02.2014 10:17:48</contoldate>
		<address>
			<building>Москва г, Вавилова ул, 67</building>
			<flat>13</flat>
		</address>
		<fio>Юрий Лебедев Викторович</fio>
		<account>2011067013</account>
	</request>
	<request id="000000003" number="2" status="9" category="1">
		<title>Течет кран в ванной</title>
		<text>Течет кран в ванной</text>
		<date>12.02.2014 14:25:11</date>
		<contoldate>14.02.2014 14:25:11</contoldate>
		<address>
			<building>Москва г, Вавилова ул, 67</building>
			<flat>13</flat>
		</address>
		<fio>Юрий Лебедев Викторович</fio>
		<account>2011067013</account>
		<status date="14.02.2014 10:53:04" user="5S" user_name="Диспетчер">6</status>
		<status date="14.02.2014 10:53:30" user="4S" user_name="Подрядная организация">7</status>
		<status date="14.02.2014 10:53:45" user="4S" user_name="Подрядная организация">8</status>
		<status date="14.02.2014 10:54:20" user="5S" user_name="Диспетчер">9</status>
	</request>
</requests>
```

# Описание элементов

## `requests`

Корневой элемент файла. Содержит элементы `statuses` (справочник статусов), `categories` (спривочник категорий) и [`request`](#Описание-элементов_request) (обращения).

**Атрибуты**

|              | Тип              | Описание |
| -------------| ---------------- | --- |
| **filedate** | Дата и время     | Дата формирования выгрузки |
| filetype     | Строка           | Содержит `tickets` |
| version		 | Целое число      | Содержит текущую версию формата обмена — `3` |

## `status`

Представляет собой элемент в *справочнике статусов* обращений (элемент `statuses`). Статусы обращений находятся на административной странице *Сервисы — ТСЖ: Аварийно-диспетчерская служба — Справочники — Статусы*.

**Атрибуты**

|              | Тип                | Описание |
| -------------| ------------------ | -------- |
| **id**       | Целое число        | Уникальный в рамках копии *Продукта* идентификатор статуса |
| **title**    | Строка             | Наименование статуса |

## `category`

Представляет собой элемент в *справочнике типов заявок* (элемент `categories`). Типы заявок находятся на административной странице *Сервисы — ТСЖ: Аварийно-диспетчерская служба — Справочники — Типы заявок*.

**Атрибуты**

|              | Тип                | Описание |
| -------------| ------------------ | -------- |
| **id**       | Целое число        | Уникальный в рамках копии *Продукта* идентификатор типа заявки |
| **title**    | Строка             | Наименование типа заявки |

## `request`

В тегах `request` выгружаются сами обращения в Аварийно-диспетчерскую службу (административная страница *Сервисы — ТСЖ: Аварийно-диспетчерская служба — Обращения*).

**Вложенные элементы**

|                 | Тип                | Описание |
| --------------- | ------------------ | -------- |
| **title**       | Строка             | Заголовок обращения (заполняется автором обращения) |
| **text**        | Строка             | Текст обращения (заполняется автором обращения) |
| **date**        | Дата и время       | Дата создания обращения |
| **controldate** | Дата и время       | Контрольная дата выполнения заявки |
| **fio**         | Строка             | ФИО автора обращения (заполняется автором обращения) |
| **account**     | Строка             | Номер лицевого счета обратившегося (заполняется автором обращения) |
| **address**     | [`address`](#Описание-элементов_address)  | Адрес (заполняется автором обращения) |
| status          | [`request-status`](#Описание-элементов_request-status)   | Содержит запись в истории изменений статуса обращения |

**Атрибуты**

|                 | Тип                | Описание |
| --------------- | ------------------ | -------- |
| **id**          | Строка             | Идентификатор обращения |
| **number**      | Целое число        | Порядковый номер обращения |
| **status**      | Целое число        | Идентификатор текущего [статуса](#Описание-элементов_status) обращения |
| category        | Целое число        | Идентификатор присвоенной [категории](#Описание-элементов_category) обращения |

## `address`

**Атрибуты**

|                 | Тип                | Описание |
| --------------- | ------------------ | -------- |
| **building**    | Строка             | Адрес дома |
| **flat**        | Строка             | Номер квартиры |

## `request-status`

Запись в истории изменений статуса обращения, такие элементы `<status>` могут быть размещены внутри обращения ([`<request>`](#Описание-элементов_request)). **Значение** является `id` статуса из [справочника статусов обращений](#Описание-элементов_status).


**Атрибуты**

|                 | Тип                | Описание |
| --------------- | ------------------ | -------- |
| **date**        | Дата и время       | Дата присвоения статуса |
| user            | Код пользователя   | Если изменение было внесено диспетчером или подрядной организацией, будет соответствовать коду, загруженному при [импорте подрядных организаций](import-tickets-org) |
| **user_name**   | Имя пользователя   | ФИО либо наименование организации |
